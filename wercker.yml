box: ubuntu
build:
  steps:
    - script:
        name: install dependencies
        code: |
          apt-get update
          apt-get install -y build-essential pkg-config libfuse-dev libarchive-dev curl python3
          curl https://sh.rustup.rs | sh -s -- -y
          export PATH=~/.cargo/bin:$PATH

    - script:
        name: test stable
        code: |
          ./tool/make_assets.py
          cargo test

    - script:
        name: test nightly
        code: |
          rustup install nightly
          rustup run nightly cargo test

    - script:
        name: build
        code: cargo build
